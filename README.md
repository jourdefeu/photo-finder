# PhotoFinder

Система для автоматического распознавания лиц на множестве фотографий с мероприятий, создания уникальных идентификаторов пользователей и поиска всех снимков, где они присутствуют.
Включает админ-загрузку фото, ML-обработку, базу данных и Telegram-бота для конечных пользователей.

## Инструкция по запуску
Перед запуском необходимо создать и скачать креды с [Google Cloud Service Accounts Credentials](https://console.cloud.google.com/apis/credentials), переименовать их в `credentials.json` и поместить в корневую директорию.

В .env хранятся:
- `SERVICE_ACCOUNT_FILE="credentials.json"`
- `BOT_TOKEN`

### 1. Настройка окружения

Создайте и активируйте виртуальное окружение Python:

```
python -m venv photo_finder
```
```
photo_finder\Scripts\activate
```

Установите необходимые зависимости:

```
pip install -r requirements.txt
```


### 2. Загрузка фотографий

Перед началом работы загрузите новые фотографии с Google диска в папку с помощью команды:

```
python ./scr/load_photos.py
```
Фото загрузятся в папку `data/photos/raw_uploads/`

---

### 3. Обработка и распределение фотографий по пользователям

После загрузки фотографий выполните команду для распределения фотографий по лицам:

```
python ./ml_worker/worker.py
```

Скрипт выполняет:
- детекцию лиц на новых фотографиях;
- извлечение эмбеддингов;
- кластеризацию лиц;
- обновление векторной базы и распределение снимков по пользователям.

Результаты сохраняются в:
- `data/vectors/` — векторная база FAISS и метаданные;
- `data/photos/users/` — фотографии, распределённые по пользователям.

---

### 4. Запуск Telegram-бота

Когда база обновлена, запустите бота с помощью команды:

```
python ./bot/main.py
```

Бот использует актуальную векторную базу и папки пользователей для поиска и работы с изображениями.

---

### Структура проекта

```
photo_finder/
├── bot/
│   └── main.py               # Telegram-бот
├── ml_worker/
│   ├── worker.py             # основная логика, кластеризация и обновление базы
│   ├── detector.py           # обнаружение лиц
│   ├── embedder.py           # векторизация и сохранение в бд
│   ├── update.py             # обновление бд
│   └── search.py             # поиск по векторной бд
├── scr/
│   └── load_photos.py        # загрузка новых фото
├── data/
│   ├── photos/
│   │   ├── raw_uploads/      # исходные фото
│   │   └── users/            # фото, распределённые по лицам
│   ├── vectors/              # FAISS-вектора и метаданные
│   └── temporary/            # папка для временного хранения фото
└── README.md
```
