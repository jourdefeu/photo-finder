# üß† PhotoFinder ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏—Ü –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, 
—Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ–∏—Å–∫–∞ –≤—Å–µ—Ö —Å–Ω–∏–º–∫–æ–≤, –≥–¥–µ –æ–Ω–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç.  
–í–∫–ª—é—á–∞–µ—Ç –∞–¥–º–∏–Ω-–∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ, ML-–æ–±—Ä–∞–±–æ—Ç–∫—É, –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ Telegram-–±–æ—Ç–∞ –¥–ª—è –∫–æ–Ω–µ—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

## üìÅ –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
facefinder/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ .env

‚îú‚îÄ‚îÄ app/                          # –û—Å–Ω–æ–≤–Ω–æ–π API —Å–µ—Ä–≤–∏—Å (FastAPI)
‚îÇ   ‚îú‚îÄ‚îÄ main.py                   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (FastAPI)
‚îÇ   ‚îú‚îÄ‚îÄ config.py                 # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ db/                       # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py               # SQLAlchemy init
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py             # –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü ORM
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ crud.py               # CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ (users, photos...)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migrations/           # Alembic –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas/                  # Pydantic-—Å—Ö–µ–º—ã (–≤–∞–ª–∏–¥–∞—Ü–∏—è API)
‚îÇ   ‚îú‚îÄ‚îÄ routes/                   # –ú–∞—Ä—à—Ä—É—Ç—ã FastAPI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search.py             # /search
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py              # /admin/upload_batch
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users.py              # /users/{id}/photos
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ embeddings.py         # –ò–Ω—Ñ–µ—Ä–µ–Ω—Å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ faiss_index.py        # –û–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ FAISS
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage.py            # –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.py              # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ workers/
‚îÇ       ‚îî‚îÄ‚îÄ enqueue.py            # –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á –≤ Redis

‚îú‚îÄ‚îÄ ml_worker/                    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–µ–π (–≤–æ—Ä–∫–µ—Ä)
‚îÇ   ‚îú‚îÄ‚îÄ worker.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤–æ—Ä–∫–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ detector.py               # –î–µ—Ç–µ–∫—Ü–∏—è –ª–∏—Ü (RetinaFace)
‚îÇ   ‚îú‚îÄ‚îÄ aligner.py                # –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ª–∏—Ü
‚îÇ   ‚îú‚îÄ‚îÄ embedder.py               # –≠–∫—Å—Ç—Ä–∞–∫—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ clusterizer.py            # –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ª–∏—Ü (DBSCAN)
‚îÇ   ‚îú‚îÄ‚îÄ updater.py                # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î + FAISS
‚îÇ   ‚îú‚îÄ‚îÄ quality.py                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (—Ä–∞–∑–º—ã—Ç–∏–µ, –ø–æ–∑–∞)
‚îÇ   ‚îî‚îÄ‚îÄ utils/                    # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)

‚îú‚îÄ‚îÄ bot/                          # Telegram –±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ main.py                   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ aiogram
‚îÇ   ‚îú‚îÄ‚îÄ handlers.py               # –•—ç–Ω–¥–ª–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ api_client.py             # –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ API
‚îÇ   ‚îî‚îÄ‚îÄ keyboards.py              # –ö–Ω–æ–ø–∫–∏ –∏ –º–µ–Ω—é

‚îú‚îÄ‚îÄ scripts/                      # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ init_db.py                # –ü–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü
‚îÇ   ‚îú‚îÄ‚îÄ rebuild_faiss.py          # –ü–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ load_from_yadisk.py       # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ —Å –Ø.–î–∏—Å–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ import_batch.py           # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞—Ç—á–∞ –≤ –æ—á–µ—Ä–µ–¥—å

‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ photos/                   # –•—Ä–∞–Ω–∏–ª–∏—â–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ raw_uploads/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ thumbnails/
‚îÇ   ‚îú‚îÄ‚îÄ faiss/
‚îÇ   ‚îî‚îÄ‚îÄ temp/

‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ test_api.py
    ‚îú‚îÄ‚îÄ test_worker.py
    ‚îî‚îÄ‚îÄ test_bot.py

```

---

## üß© –ö–ª—é—á–µ–≤—ã–µ –º–æ–¥—É–ª–∏ –∏ –∏—Ö –∑–∞–¥–∞—á–∏

### `app/` ‚Äî API-—Å–µ—Ä–≤–∏—Å
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç Telegram-–±–æ—Ç–∞ –∏ –∞–¥–º–∏–Ω–∫–∏.  
- –î–µ–ª–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ FAISS.  
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (PostgreSQL).  
- –§–æ—Ä–º–∏—Ä—É–µ—Ç –∏ —Å—Ç–∞–≤–∏—Ç –∑–∞–¥–∞—á–∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤—ã—Ö —Ñ–æ—Ç–æ –≤ Redis.

### `ml_worker/` ‚Äî ML-–æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ü–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ (Redis).  
- –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –ª–∏—Ü–∞ ‚Üí –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç ‚Üí –∏–∑–≤–ª–µ–∫–∞–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏.  
- –û—Ü–µ–Ω–∏–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∏–º–∫–æ–≤.  
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ—Ö–æ–∂–∏–µ –ª–∏—Ü–∞ –≤ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è).  
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î –∏ –∏–Ω–¥–µ–∫—Å FAISS.

### `bot/` ‚Äî Telegram-–±–æ—Ç
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–æ—Ç–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.  
- –í—ã–∑—ã–≤–∞–µ—Ç `/search` API.  
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.  
- –ú–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–µ—Ä–µ—Å–ª–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è.

### `scripts/` ‚Äî –£—Ç–∏–ª–∏—Ç—ã
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π –∏ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏.  
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫).  
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è FAISS.

---

## üß± –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|------------|
| `photos` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–æ—Ç–æ, –ø—É—Ç–∏ –∫ –Ω–∏–º, –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ |
| `faces` | –û—Ç–¥–µ–ª—å–Ω—ã–µ –ª–∏—Ü–∞ –Ω–∞ —Ñ–æ—Ç–æ, –∏—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –∏ user_id |
| `users` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (—É—Å—Ä–µ–¥–Ω—ë–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏) |
| `user_photos` | –°–≤—è–∑—å `user_id ‚Üî photo_id` |
| `upload_batches` | –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ (–±–∞—Ç—á–∏ –∏–∑ –Ø.–î–∏—Å–∫–∞ –∏ —Ç.–ø.) |

---

## üîÅ –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–±–æ—Ç—ã

1. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ `/admin/upload_batch` ‚Üí  
   API –∫–ª–∞–¥—ë—Ç –∑–∞–¥–∞—á—É –≤ Redis Queue.  
2. **ML-–≤–æ—Ä–∫–µ—Ä** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ—Ç–æ:  
   –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –ª–∏—Ü–∞ ‚Üí —Å—Ç—Ä–æ–∏—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ ‚Üí –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∏—Ö –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.  
3. **–ë–î** –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è, –∞ FAISS –∏–Ω–¥–µ–∫—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è.  
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ –≤ Telegram-–±–æ—Ç–∞ ‚Üí  
   –±–æ—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `/search` ‚Üí API –∏—â–µ—Ç –±–ª–∏–∂–∞–π—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥—É.  
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤—Å–µ —Å–Ω–∏–º–∫–∏, –≥–¥–µ –æ–Ω –Ω–∞–π–¥–µ–Ω.

---

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è

- –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (Redis).  
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–µ–±-–∞–¥–º–∏–Ω–∫—É –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.  
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –º–∏–Ω–∏–∞—Ç—é—Ä –∏ –ª–µ–Ω–∏–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ.  
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus + Grafana).  
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ–æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

---

¬© 2025 PhotoFinder ‚Äî —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ª—é–¥–µ–π –ø–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º.







