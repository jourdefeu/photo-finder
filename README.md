## ๐งฑ ะะปะพะบ-ััะตะผะฐ ััะพะฒะฝะตะน
```
                โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ       ะะดะผะธะฝ-ะฟะฐะฝะตะปั       โ
                โ (ะทะฐะณััะทะบะฐ ัะพัะพ ั ะฏ.ะะธัะบะฐ)โ
                โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
                             โ
                             โผ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ  ETL + Face Recognition Pipeline       โ
         โ - ะะตัะตะบัะธั ะธ ะฒััะฐะฒะฝะธะฒะฐะฝะธะต ะปะธั          โ
         โ - ะะทะฒะปะตัะตะฝะธะต ัะผะฑะตะดะดะธะฝะณะพะฒ (DeepFace)    โ
         โ - ะะปะฐััะตัะธะทะฐัะธั ะธ ะฟัะธัะฒะพะตะฝะธะต user_id   โ
         โ - ะกะพััะฐะฝะตะฝะธะต (user_id โ photo_ids)     โ
         โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
                          โผ
          โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
          โ       Database / Storage        โ
          โ - users: user_id, mean_embeddingโ
          โ - photos: photo_id, path        โ
          โ - mapping: user_id โ photo_ids  โ
          โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
                           โ
                           โผ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ Telegram Bot Interface     โ
              โ - ะฟัะธะฝะธะผะฐะตั ัะพัะพ           โ
              โ - ะธัะตั user_id ะฟะพ embeddingโ
              โ - ะฒะพะทะฒัะฐัะฐะตั ัะพัะพ          โ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

```

# ๐งฉ FaceFinder โ ะะพะปะฝัะน ะฟะฐะนะฟะปะฐะนะฝ ัะธััะตะผั ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธั ะปะธั

---

## 1๏ธโฃ ะะฐะณััะทะบะฐ ะธ ะฟะตัะฒะธัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ัะพัะพ (ะฐะดะผะธะฝ-ะทะพะฝะฐ)

**ะฆะตะปั:** ะทะฐะณััะทะธัั ะฟะฐัะบั ัะพัะพ ั ะผะตัะพะฟัะธััะธะน, ัะฐัะฟะพะทะฝะฐัั ะฒัะตั ะปัะดะตะน ะธ ัะฐัะฟัะตะดะตะปะธัั ะธั ะฟะพ ID-ะฟะพะปัะทะพะฒะฐัะตะปัะผ.

### โ๏ธ ะญัะฐะฟั:

1. **ะะฐะณััะทะบะฐ ะธััะพะดะฝัั ัะพัะพ**
   - ะะดะผะธะฝ ะทะฐะณััะถะฐะตั ัะพัะพะณัะฐัะธะธ ั ะฏะฝะดะตะบั.ะะธัะบะฐ ะธะปะธ ะปัะฑะพะณะพ ะฒะฝะตัะฝะตะณะพ ะธััะพัะฝะธะบะฐ.
   - ะกะบัะธะฟั ัะบะฐัะธะฒะฐะตั ะฒัะต ัะฐะนะปั ะฒ ะดะธัะตะบัะพัะธั:
     ```
     /srv/project/photos/raw_uploads/
     ```

2. **ะะฑัะฐะฑะพัะบะฐ ัะพัะพ**
   - ะะปั ะบะฐะถะดะพะณะพ ะธะทะพะฑัะฐะถะตะฝะธั:
     - ะะตัะตะบัะธัััััั ะปะธัะฐ (`MTCNN` / `RetinaFace`);
     - ะัะพะธะทะฒะพะดะธััั ะฒััะฐะฒะฝะธะฒะฐะฝะธะต ะปะธัะฐ (**2D/3D alignment**);
     - ะะทะฒะปะตะบะฐะตััั ัะผะฑะตะดะดะธะฝะณ ะปะธัะฐ (`ArcFace` ะธะปะธ `AdaFace` ัะตัะตะท `InsightFace` / `DeepFace`);
     - ะะฟัะตะดะตะปัะตััั ัะณะพะป ะฟะพะฒะพัะพัะฐ ะณะพะปะพะฒั (**pose estimation**);
     - ะัะปะธ ะปะธัะพ ัะธะปัะฝะพ ะฟะพะฒะตัะฝััะพ โ ะปะธะฑะพ ะฟัะพะฟััะบะฐะตััั, ะปะธะฑะพ ะธัะฟะพะปัะทัะตััั 3D-ัะตะบะพะฝััััะบัะธั.

3. **ะกะพะฟะพััะฐะฒะปะตะฝะธะต ะปะธั ั ัััะตััะฒัััะธะผะธ ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ**
   - ะญะผะฑะตะดะดะธะฝะณ ััะฐะฒะฝะธะฒะฐะตััั ั `mean_embedding` ะฒ ะะ (ัะตัะตะท **FAISS** ะธะปะธ **cosine distance**);
   - ะัะปะธ ัะฐัััะพัะฝะธะต < `threshold` โ ะปะธัะพ ะพัะฝะพัะธััั ะบ ัะถะต ัััะตััะฒัััะตะผั ะฟะพะปัะทะพะฒะฐัะตะปั (`user_id`);
   - ะัะปะธ ัะพะฒะฟะฐะดะตะฝะธะน ะฝะตั โ ัะพะทะดะฐัััั ะฝะพะฒัะน `user_id`.

4. **ะฃััะตะดะฝะตะฝะธะต ัะผะฑะตะดะดะธะฝะณะพะฒ (multi-view embedding)**
   - ะัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ะฝะพะฒะพะณะพ ัะพัะพ ะพะฑะฝะพะฒะปัะตััั ััะตะดะฝะธะน ะฒะตะบัะพั ะปะธัะฐ ะฟะพะปัะทะพะฒะฐัะตะปั, ััะพะฑั ััะตััั ัะฐะทะฝัะต ัะฐะบัััั.

5. **ะกะพััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั**
   - ะคะพัะพ ัะพััะฐะฝัะตััั ะปะพะบะฐะปัะฝะพ:
     ```
     /srv/project/photos/{user_id}/{photo_id}.jpg
     ```
   - ะ ะะ ะดะพะฑะฐะฒะปัะตััั ะทะฐะฟะธัั:

     **ะขะฐะฑะปะธัะฐ `photos`**
     | photo_id | file_path | upload_date | meta (pose, quality) |
     |-----------|------------|--------------|----------------------|

     **ะขะฐะฑะปะธัะฐ `users`**
     | user_id | mean_embedding | created_at |
     |----------|----------------|-------------|

     **ะขะฐะฑะปะธัะฐ `user_photos`**
     | user_id | photo_id |
     |----------|-----------|

---

## 2๏ธโฃ ะะฐะทะฐ ะดะฐะฝะฝัั ะธ ะธะฝะดะตะบัั

**ะฆะตะปั:** ะพะฑะตัะฟะตัะธัั ะฑัััััะน ะฟะพะธัะบ ะฟะพ ะปะธัะฐะผ ะธ ะดะพัััะฟ ะบ ัะพัะพ.

### โ๏ธ ะกะพััะฐะฒ:
- **PostgreSQL** โ ััะฐะฝะตะฝะธะต ะผะตัะฐะดะฐะฝะฝัั, ัะฒัะทะตะน ะธ ะฟััะตะน ะบ ัะฐะนะปะฐะผ.
- **FAISS** โ ะฑัััััะน ะฟะพะธัะบ ะฑะปะธะถะฐะนัะธั ัะผะฑะตะดะดะธะฝะณะพะฒ.
- **ะฅัะฐะฝะธะปะธัะต ัะฐะนะปะพะฒ ะฝะฐ ัะตัะฒะตัะต:**
```
/srv/project/photos/
โโโ 0001/
โ   โโโ 1.jpg
โ   โโโ 2.jpg
โโโ 0002/
โ   โโโ 5.jpg
โ   โโโ 6.jpg
โโโ ...
```
๐พ ะกะพะดะตัะถะฐะฝะธะต ัะฐะฑะปะธั:

users
| user_id | mean_embedding (vector) | created_at |

photos
| photo_id | file_path | upload_date | meta (pose, quality) |

user_photos
| user_id | photo_id |

3๏ธโฃ Telegram-ะฑะพั: ะฟะพะธัะบ ะฟะพ ะปะธัั

ะฆะตะปั: ะฟะพะปัะทะพะฒะฐัะตะปั ะทะฐะณััะถะฐะตั ัะพัะพ โ ะฟะพะปััะฐะตั ะฒัะต ัะพัะพ, ะณะดะต ะพะฝ ะตััั.

โ๏ธ ะจะฐะณะธ:

ะะพะปัะทะพะฒะฐัะตะปั ะพัะฟัะฐะฒะปัะตั ัะพัะพ ะฒ ะฑะพั.

ะะพั ัะพััะฐะฝัะตั ัะพัะพ ะฒะพ ะฒัะตะผะตะฝะฝัั ะดะธัะตะบัะพัะธั /srv/project/temp/.

ML-ะผะพะดัะปั:

ะธะทะฒะปะตะบะฐะตั ะปะธัะพ โ ะฒััะฐะฒะฝะธะฒะฐะตั โ ะฟะพะปััะฐะตั ัะผะฑะตะดะดะธะฝะณ;

ะธัะตั ะฑะปะธะถะฐะนัะธะน mean_embedding ะฒ FAISS / ะะ;

ะตัะปะธ ะฝะฐะนะดะตะฝะพ ัะพะฒะฟะฐะดะตะฝะธะต < threshold โ ะฟะพะปััะฐะตั user_id.

ะะพั ะดะพััะฐัั ะฒัะต photo_id ะธะท user_photos ะดะปั ััะพะณะพ user_id.

ะะพ photo_id ะฟะพะปััะฐะตั ะฟััะธ ะธะท photos.file_path.

ะัะฟัะฐะฒะปัะตั ะฟะพะปัะทะพะฒะฐัะตะปั ะฒัะต ะฝะฐะนะดะตะฝะฝัะต ัะพัะพ (ะฟะพ 10 ัััะบ ะทะฐ ัะฐะท, ั ะฟะฐะณะธะฝะฐัะธะตะน).

4๏ธโฃ ะะตัะฐะฝะธะทะผั ัััะพะนัะธะฒะพััะธ ะธ ะบะฐัะตััะฒะฐ

โ ะััะฐะฒะฝะธะฒะฐะฝะธะต (Alignment) โ ะฒัะฐัะฐะตะผ ะปะธัะพ ะฒ ััะพะฝัะฐะปัะฝัะน ะฒะธะด ะฟะตัะตะด ัะผะฑะตะดะดะธะฝะณะพะผ.
โ Multi-view Embeddings โ ัััะตะดะฝัะตะผ ะฒะตะบัะพั ะฟะพ ะฒัะตะผ ัะพัะพ ะฟะพะปัะทะพะฒะฐัะตะปั.
โ Pose filtering โ ะฟัะธ ะทะฐะณััะทะบะต ะธะณะฝะพัะธััะตะผ ัะพัะพ ั ะฟะพะฒะพัะพัะพะผ > 70ยฐ.
โ ะะธะฑะบะธะน threshold โ ะตัะปะธ ัะพะฒะฟะฐะดะตะฝะธะต ะฝะตัะฒะตัะตะฝะฝะพะต, ะฑะพั ะผะพะถะตั ะฟะพะบะฐะทะฐัั ยซะฒะพะทะผะพะถะฝัะต ัะพะฒะฟะฐะดะตะฝะธัยป.
โ ะััะธัะพะฒะฐะฝะธะต โ ัะผะฑะตะดะดะธะฝะณะธ ะธ ะฟััะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ััะฐะฝัััั ะฒ Redis, ััะพะฑั ััะบะพัะธัั ะฟะพะธัะบ.

5๏ธโฃ ะะดะผะธะฝ-ะฟะฐะฝะตะปั

ะัะพัะผะพัั ะธ ะฒะฐะปะธะดะฐัะธั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐะฝะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน (ะพะฑัะตะดะธะฝะตะฝะธะต/ัะฐะทะดะตะปะตะฝะธะต).

ะฃะดะฐะปะตะฝะธะต ะดัะฑะปะตะน (ะตัะปะธ ะผะพะดะตะปั ะพัะธะฑะปะฐัั ะธ ัะพะทะดะฐะปะฐ ะดะฒัั ะฟะพัะพะถะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน).

ะัะพัะผะพัั ะผะตัะฐะดะฐะฝะฝัั ะฟะพ ะบะฐัะตััะฒั ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธั.
